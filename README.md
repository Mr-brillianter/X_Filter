# X Filter - Twitter/X 浏览器插件

一个功能强大的 Edge 浏览器插件，用于优化 X（原 Twitter）的浏览体验，提供视觉优化和智能内容过滤功能。

## 📋 功能特性

### 功能1：瀑布流视觉模式 ✅

将 X 平台的帖子转换为以图片和视频为中心的瀑布流布局，提供类似小红书的沉浸式浏览体验。

**核心特性：**
- **瀑布流布局**：采用响应式瀑布流（Masonry）布局，自动适配不同屏幕尺寸
- **媒体优先显示**：
  - 图片和视频铺满卡片区域
  - 自动隐藏或最小化文字内容
  - 支持多图展示（网格或轮播）
- **交互优化**：
  - 悬停显示完整信息（作者、点赞数、评论数等）
  - 点击放大查看原图/视频
  - 平滑滚动加载更多内容
- **视图切换**：
  - 一键切换原始视图和瀑布流视图
  - 保存用户偏好设置
- **性能优化**：
  - 懒加载机制，仅加载可视区域内容
  - 图片压缩和缓存
  - 虚拟滚动支持大量内容

**技术实现：**
- 使用 CSS Grid 或 Masonry 库实现瀑布流布局
- MutationObserver 监听 DOM 变化，实时处理新加载的帖子
- IntersectionObserver 实现懒加载和无限滚动
- 自定义 CSS 注入覆盖原始样式

### 功能2：智能视频过滤 🚧

基于 AI 的视频内容检测和过滤系统，帮助用户自定义浏览内容。

**检测能力：**
1. **人脸检测**：识别视频中是否包含人脸
2. **NSFW 检测**：检测不适宜内容
3. **自定义过滤规则**：基于检测结果自动过滤或标记内容

**技术实现：**
- 使用 TensorFlow.js 或 ONNX Runtime 进行客户端 AI 推理
- 人脸检测：face-api.js 或 MediaPipe
- NSFW 检测：NSFW.js 或自定义模型
- 后台处理避免阻塞主线程

## 🏗️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        X Filter 插件                          │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │   Popup UI   │  │   Options    │  │   Background │      │
│  │   (弹出页面)  │  │   (设置页面)  │  │   (后台脚本)  │      │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘      │
│         │                  │                  │              │
│         └──────────────────┴──────────────────┘              │
│                            │                                 │
│                   ┌────────▼────────┐                        │
│                   │  Storage API    │                        │
│                   │  (用户设置存储)   │                        │
│                   └─────────────────┘                        │
│                                                               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │            Content Script (内容脚本)                   │   │
│  ├──────────────────────────────────────────────────────┤   │
│  │                                                        │   │
│  │  ┌─────────────────┐      ┌─────────────────┐        │   │
│  │  │  DOM Observer   │      │  Layout Engine  │        │   │
│  │  │  (页面监听器)    │─────▶│  (布局引擎)      │        │   │
│  │  └─────────────────┘      └─────────────────┘        │   │
│  │           │                         │                 │   │
│  │           │                         ▼                 │   │
│  │           │                ┌─────────────────┐        │   │
│  │           │                │  Style Injector │        │   │
│  │           │                │  (样式注入器)    │        │   │
│  │           │                └─────────────────┘        │   │
│  │           │                                            │   │
│  │           ▼                                            │   │
│  │  ┌─────────────────┐      ┌─────────────────┐        │   │
│  │  │  Media Extractor│      │  AI Detector    │        │   │
│  │  │  (媒体提取器)    │─────▶│  (AI 检测器)     │        │   │
│  │  └─────────────────┘      └─────────────────┘        │   │
│  │                                     │                 │   │
│  │                            ┌────────▼────────┐        │   │
│  │                            │  Filter Engine  │        │   │
│  │                            │  (过滤引擎)      │        │   │
│  │                            └─────────────────┘        │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                 │
└────────────────────────────┼─────────────────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   X (Twitter)   │
                    │   网页 DOM       │
                    └─────────────────┘
```

### 核心模块说明

#### 1. **Popup UI（弹出界面）**
- 快速开关插件功能
- 切换视图模式（原始/瀑布流）
- 显示当前过滤统计
- 快捷设置入口

#### 2. **Options Page（设置页面）**
- 瀑布流布局配置（列数、间距、卡片样式）
- AI 检测开关和阈值设置
- 过滤规则自定义
- 数据统计和导出

#### 3. **Background Script（后台脚本）**
- 管理插件生命周期
- 处理跨标签页通信
- 缓存管理
- AI 模型加载和管理

#### 4. **Content Script 核心组件**

##### DOM Observer（DOM 监听器）
- 使用 MutationObserver 监听页面变化
- 识别新加载的帖子
- 提取帖子数据结构
- 触发布局更新

##### Layout Engine（布局引擎）
- 计算瀑布流布局位置
- 管理虚拟滚动
- 处理响应式调整
- 优化渲染性能

##### Style Injector（样式注入器）
- 注入自定义 CSS
- 覆盖原始样式
- 动态主题切换
- 动画效果管理

##### Media Extractor（媒体提取器）
- 从帖子中提取图片和视频 URL
- 处理不同媒体格式
- 获取媒体元数据
- 预加载优化

##### AI Detector（AI 检测器）
- 加载 TensorFlow.js/ONNX 模型
- 人脸检测处理
- NSFW 内容检测
- Web Worker 异步处理

##### Filter Engine（过滤引擎）
- 应用用户过滤规则
- 内容标记和隐藏
- 统计过滤数据
- 白名单/黑名单管理

### 数据流

```
用户浏览 X 页面
    │
    ▼
DOM Observer 检测到新帖子
    │
    ├─▶ Media Extractor 提取媒体
    │        │
    │        ▼
    │   AI Detector 分析内容
    │        │
    │        ▼
    │   Filter Engine 应用规则
    │        │
    │        ▼
    │   决定是否显示/隐藏
    │
    └─▶ Layout Engine 计算布局
         │
         ▼
    Style Injector 应用样式
         │
         ▼
    渲染瀑布流视图
```

## 🛠️ 技术栈

### 前端技术
- **HTML/CSS/JavaScript**：核心开发语言
- **CSS Grid/Flexbox**：布局系统
- **Masonry.js**（可选）：瀑布流布局库

### 浏览器 API
- **Chrome Extension API**：插件基础框架
- **MutationObserver**：DOM 变化监听
- **IntersectionObserver**：懒加载和可见性检测
- **Storage API**：用户设置持久化

### AI/ML 库
- **TensorFlow.js**：机器学习框架
- **face-api.js**：人脸检测
- **NSFW.js**：NSFW 内容检测
- **ONNX Runtime Web**：模型推理引擎

### 构建工具
- **Webpack/Vite**：打包工具
- **Babel**：JavaScript 编译
- **PostCSS**：CSS 处理

## 📦 项目结构

```
X_filter/
├── manifest.json           # 插件配置文件
├── popup/                  # 弹出页面
│   ├── popup.html
│   ├── popup.js
│   └── popup.css
├── options/                # 设置页面
│   ├── options.html
│   ├── options.js
│   └── options.css
├── background/             # 后台脚本
│   └── background.js
├── content/                # 内容脚本
│   ├── content.js          # 主入口
│   ├── observer.js         # DOM 监听
│   ├── layout.js           # 布局引擎
│   ├── style.js            # 样式注入
│   ├── media.js            # 媒体提取
│   ├── detector.js         # AI 检测
│   └── filter.js           # 过滤引擎
├── styles/                 # 样式文件
│   ├── waterfall.css       # 瀑布流样式
│   └── override.css        # 覆盖样式
├── models/                 # AI 模型文件
│   ├── face-detection/
│   └── nsfw-detection/
├── assets/                 # 资源文件
│   ├── icons/
│   └── images/
├── utils/                  # 工具函数
│   ├── storage.js
│   ├── message.js
│   └── helpers.js
└── README.md
```

## 🚀 开发计划

### Phase 1: 基础框架 ✅
- [x] 项目初始化
- [x] 插件基础结构搭建
- [ ] Manifest V3 配置

### Phase 2: 功能1 - 瀑布流视图 🚧
- [ ] DOM 监听和帖子识别
- [ ] 媒体提取逻辑
- [ ] 瀑布流布局实现
- [ ] 样式注入和覆盖
- [ ] 交互优化（悬停、点击）
- [ ] 性能优化（懒加载、虚拟滚动）

### Phase 3: 功能2 - AI 检测 📅
- [ ] TensorFlow.js 集成
- [ ] 人脸检测实现
- [ ] NSFW 检测实现
- [ ] Web Worker 优化
- [ ] 过滤规则引擎

### Phase 4: 优化和发布 📅
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 多语言支持
- [ ] 打包和发布

## 📝 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！